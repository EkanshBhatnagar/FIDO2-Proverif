<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1041px" preserveAspectRatio="none" style="width:943px;height:1041px;background:#FFFFFF;" version="1.1" viewBox="0 0 943 1041" width="943px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="194.1953" style="stroke:#000000;stroke-width:1.5;" width="610.2051" x="49" y="256.3594"/><g><title>Authenticator</title><rect fill="#000000" fill-opacity="0.00000" height="969.5781" width="8" x="169.8823" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="173" x2="173" y1="36.2969" y2="1005.875"/></g><g><title>User</title><rect fill="#000000" fill-opacity="0.00000" height="969.5781" width="8" x="377.7197" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="380.7646" x2="380.7646" y1="36.2969" y2="1005.875"/></g><g><title>Client</title><rect fill="#000000" fill-opacity="0.00000" height="969.5781" width="8" x="557.9399" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="561.6748" x2="561.6748" y1="36.2969" y2="1005.875"/></g><g><title>RelyingParty</title><rect fill="#000000" fill-opacity="0.00000" height="969.5781" width="8" x="766.5635" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="770.2051" x2="770.2051" y1="36.2969" y2="1005.875"/></g><g class="participant participant-head" data-participant="A"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="109.7646" x="119" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95.7646" x="126" y="24.9951">Authenticator</text></g><g class="participant participant-tail" data-participant="A"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="109.7646" x="119" y="1004.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95.7646" x="126" y="1024.8701">Authenticator</text></g><g class="participant participant-head" data-participant="U"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="45.9102" x="358.7646" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.9102" x="365.7646" y="24.9951">User</text></g><g class="participant participant-tail" data-participant="U"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="45.9102" x="358.7646" y="1004.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.9102" x="365.7646" y="1024.8701">User</text></g><g class="participant participant-head" data-participant="C"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54.5303" x="534.6748" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="541.6748" y="24.9951">Client</text></g><g class="participant participant-tail" data-participant="C"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54.5303" x="534.6748" y="1004.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="541.6748" y="1024.8701">Client</text></g><g class="participant participant-head" data-participant="RP"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102.7168" x="719.2051" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88.7168" x="726.2051" y="24.9951">RelyingParty</text></g><g class="participant participant-tail" data-participant="RP"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102.7168" x="719.2051" y="1004.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88.7168" x="726.2051" y="1024.8701">RelyingParty</text></g><rect fill="#FEFFDD" height="23" style="stroke:#181818;stroke-width:0.5;" width="402" x="465" y="51.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133.2373" x="599.5049" y="67.3638">TLS Setup (tbinding)</text><g class="message" data-participant-1="C" data-participant-2="RP"><polygon fill="#181818" points="758.5635,111.6953,768.5635,115.6953,758.5635,119.6953,762.5635,115.6953" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="561.9399" x2="764.5635" y1="115.6953" y2="115.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71.4619" x="628.4546" y="95.4966">signup_req</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105.5234" x="613.49" y="110.6294">(WebAuthn,TLS)</text></g><rect fill="#FEFFDD" height="38" style="stroke:#181818;stroke-width:0.5;" width="151" x="694" y="128.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130.3047" x="698" y="144.7622">New Random nonce</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143.2729" x="698" y="159.895">New Random uhandle</text><g class="message" data-participant-1="RP" data-participant-2="C"><polygon fill="#181818" points="572.9399,204.2266,562.9399,208.2266,572.9399,212.2266,568.9399,208.2266" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="566.9399" x2="769.5635" y1="208.2266" y2="208.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.0234" x="595.1738" y="188.0278">RpId, nonce, uhandle</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105.5234" x="613.49" y="203.1606">(WebAuthn,TLS)</text></g><rect fill="#FEFFDD" height="23" style="stroke:#181818;stroke-width:0.5;" width="223" x="450" y="221.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215.0713" x="454" y="237.2935">Client searches for Authenticator</text><path d="M49,256.3594 L189.3989,256.3594 L189.3989,263.4922 L179.3989,273.4922 L49,273.4922 L49,256.3594" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="194.1953" style="stroke:#000000;stroke-width:1.5;" width="610.2051" x="49" y="256.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="95.3989" x="64" y="269.4263">CTAP - Setup</text><g class="message" data-participant-1="C" data-participant-2="A"><polygon fill="#181818" points="184.8823,305.7578,174.8823,309.7578,184.8823,313.7578,180.8823,309.7578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="178.8823" x2="560.9399" y1="309.7578" y2="309.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132.0884" x="299.8008" y="289.5591">req_authtoken, RpId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.894" x="345.9641" y="304.6919">(CTAP)</text></g><g class="message" data-participant-1="A" data-participant-2="U"><polygon fill="#181818" points="369.7197,350.0234,379.7197,354.0234,369.7197,358.0234,373.7197,354.0234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="173.8823" x2="375.7197" y1="354.0234" y2="354.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163.9219" x="193.7739" y="333.8247">Asks for User Verification</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.894" x="255.854" y="348.9575">(CTAP)</text></g><g class="message" data-participant-1="U" data-participant-2="A"><polygon fill="#181818" points="184.8823,394.2891,174.8823,398.2891,184.8823,402.2891,180.8823,398.2891" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="178.8823" x2="380.7197" y1="398.2891" y2="398.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15.9326" x="267.7686" y="378.0903">uv</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.894" x="255.854" y="393.2231">(CTAP)</text></g><g class="message" data-participant-1="A" data-participant-2="C"><polygon fill="#181818" points="549.9399,438.5547,559.9399,442.5547,549.9399,446.5547,553.9399,442.5547" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="173.8823" x2="555.9399" y1="442.5547" y2="442.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108.6401" x="311.5249" y="422.356">pinUVAuthToken</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.894" x="345.9641" y="437.4888">(CTAP)</text></g><rect fill="#FEFFDD" height="38" style="stroke:#181818;stroke-width:0.5;" width="300" x="411" y="462.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209.8979" x="415" y="478.6216">cData = &lt;RpId,nonce,tbinding&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="292.3096" x="415" y="493.7544">pinAuth = HMAC(pinUVAuthToken, h(cData))</text><g class="message" data-participant-1="C" data-participant-2="A"><polygon fill="#181818" points="184.8823,538.0859,174.8823,542.0859,184.8823,546.0859,180.8823,542.0859" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="178.8823" x2="560.9399" y1="542.0859" y2="542.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222.0918" x="254.7991" y="521.8872">RpId, h(cData), pinAuthn, uhandle</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.894" x="345.9641" y="537.02">(CTAP)</text></g><rect fill="#FEFFDD" height="38" style="stroke:#181818;stroke-width:0.5;" width="306" x="20" y="555.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="298.4478" x="24" y="571.1528">Check HMAC(pinToken, h(cData)) == pinAuth</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151.9819" x="24" y="586.2856">Generate new skA, pkA</text><g class="message" data-participant-1="A" data-participant-2="U"><polygon fill="#181818" points="369.7197,630.6172,379.7197,634.6172,369.7197,638.6172,373.7197,634.6172" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="173.8823" x2="375.7197" y1="634.6172" y2="634.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137.2236" x="207.123" y="614.4185">User Presence Check</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.894" x="255.854" y="629.5513">(CTAP)</text></g><g class="message" data-participant-1="U" data-participant-2="A"><polygon fill="#181818" points="184.8823,674.8828,174.8823,678.8828,184.8823,682.8828,180.8823,678.8828" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="178.8823" x2="380.7197" y1="678.8828" y2="678.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="16.4912" x="267.4893" y="658.6841">up</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.894" x="255.854" y="673.8169">(CTAP)</text></g><rect fill="#FEFFDD" height="53" style="stroke:#181818;stroke-width:0.5;" width="337" x="5" y="691.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="271.8955" x="9" y="707.9497">credID = senc(&lt;uhandle, RpId, skA&gt;, wk)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="329.8242" x="9" y="723.0825">aData = &lt;h(RpId), AAGUID, up, cntr, credID, pkA&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236.0313" x="9" y="738.2153">sig =  sign(&lt;aData, h(cData)&gt;, skA)</text><g class="message" data-participant-1="A" data-participant-2="C"><polygon fill="#181818" points="549.9399,782.5469,559.9399,786.5469,549.9399,790.5469,553.9399,786.5469" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="173.8823" x2="555.9399" y1="786.5469" y2="786.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61.7754" x="334.9573" y="766.3481">aData,sig</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.894" x="345.9641" y="781.481">(CTAP)</text></g><g class="message" data-participant-1="C" data-participant-2="RP"><polygon fill="#181818" points="758.5635,826.8125,768.5635,830.8125,758.5635,834.8125,762.5635,830.8125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="561.9399" x2="764.5635" y1="830.8125" y2="830.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104.0952" x="612.1379" y="810.6138">aData,sig,cData</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109.6558" x="611.4238" y="825.7466">(WebAuthn, TLS)</text></g><rect fill="#FEFFDD" height="113" style="stroke:#181818;stroke-width:0.5;" width="334" x="603" y="843.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="259.105" x="607" y="859.8794">&lt;RpId_c, nonce_c, tbinding_c&gt; = cData</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="326.9424" x="607" y="875.0122">&lt;h(RpId_c),AAGUID,up,cntr,credID, pkA&gt; = aData</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.355" x="607" y="890.145">Validate tbinding_c,up</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144.6313" x="607" y="905.2778">check RpId_c == RpId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165.0454" x="607" y="920.4106">check nonce_c == nonce</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214.5698" x="607" y="935.5435">Verify (sig,&lt;aData,h(cData),pkA)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232.3433" x="607" y="950.6763">Store (uhandle,AAGUID,credID,pkA)</text><polygon fill="#FEFFDD" points="73,967.7422,870,967.7422,880,978.7422,870,990.7422,73,990.7422,63,978.7422,73,967.7422" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151.8677" x="396.0271" y="983.8091">Successful Registration</text><!--SRC=[VLJ1Zfim4BtxA-O8aYFrr4EK85cij8tKhL0Iqakbo6ic0S4QrePTvUyxDf2ObTeB2UEPz-Qz6MFhIdVIo3UWPr-fgfEwpsHHLFeAtx-n80fYw4lKz2hxre2q81R7kKKVpHVHjAceniNJHNoFpOquCWhTtEa-OqQtFKBxGJ0ff_VZpmCSi1ywYFhNIhkMOeQwy7dCtZkt-3wWLlY2riehYgQwQb34YeQbguIWOGq0bi93TpRu3dzqz1jVdHxDYIKEgOdu5tx2NkgYVGFT4d0O64hwRV3H1zjdgoHTmxxR5NpCvtFMVubIDdbZKHfLeeKBsRemEM2vcfQCI8yYWzNeYjScra22pfAg-hP6pNqVZjUbnanGJhu6OUiHtW_fXAQwE8QgrO_KV8GRFfRL9AshT7voZHqTnUEOkcDBHUf9zXAsiF5kZ6RCiqiOuJWKEl_n8j9e2SkXZ7nv70oP98hPslcOmuIZ5pwFBONj29QMgEexsLSQs6vdAFQC6esaIasZjhKWabe4zfCJPADtBpDetRh1Y1xwv-ph_jMCCbZidaYyguusK-jyKaUS2OVFEcPozh2Ct17f5U8vtpsHsew3qhsXfyVoJIQC5flI_Nv76r_z49buvC1H4fBITHZJNEMzM_9wdmKdV1nckCBWT_ZBRV6pFgjfzzsVUU9dbL1Z7ePDQiugvfCSKkF5X5eetVEpasogmitZWKK5J7dBHo0tFlTl2axiBZfUMh_bDuYSbCcM-mfrpfC3tJ24Q1x4rDRKJhTmZPLUibIcjNODXq4f-jXSXeQ-OzVAziRVfRy0]--></g></svg>