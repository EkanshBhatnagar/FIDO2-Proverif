<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1148px" preserveAspectRatio="none" style="width:911px;height:1148px;background:#FFFFFF;" version="1.1" viewBox="0 0 911 1148" width="911px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="194.1953" style="stroke:#000000;stroke-width:1.5;" width="610.2051" x="33" y="304.625"/><g><title>Authenticator</title><rect fill="#000000" fill-opacity="0.00000" height="1077.2422" width="8" x="153.8823" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="157" x2="157" y1="36.2969" y2="1113.5391"/></g><g><title>User</title><rect fill="#000000" fill-opacity="0.00000" height="1077.2422" width="8" x="361.7197" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="364.7646" x2="364.7646" y1="36.2969" y2="1113.5391"/></g><g><title>Client</title><rect fill="#000000" fill-opacity="0.00000" height="1077.2422" width="8" x="541.9399" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="545.6748" x2="545.6748" y1="36.2969" y2="1113.5391"/></g><g><title>RelyingParty</title><rect fill="#000000" fill-opacity="0.00000" height="1077.2422" width="8" x="750.5635" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="754.2051" x2="754.2051" y1="36.2969" y2="1113.5391"/></g><g class="participant participant-head" data-participant="A"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="109.7646" x="103" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95.7646" x="110" y="24.9951">Authenticator</text></g><g class="participant participant-tail" data-participant="A"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="109.7646" x="103" y="1112.5391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95.7646" x="110" y="1132.5342">Authenticator</text></g><g class="participant participant-head" data-participant="U"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="45.9102" x="342.7646" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.9102" x="349.7646" y="24.9951">User</text></g><g class="participant participant-tail" data-participant="U"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="45.9102" x="342.7646" y="1112.5391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.9102" x="349.7646" y="1132.5342">User</text></g><g class="participant participant-head" data-participant="C"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54.5303" x="518.6748" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="525.6748" y="24.9951">Client</text></g><g class="participant participant-tail" data-participant="C"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54.5303" x="518.6748" y="1112.5391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="525.6748" y="1132.5342">Client</text></g><g class="participant participant-head" data-participant="RP"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102.7168" x="703.2051" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88.7168" x="710.2051" y="24.9951">RelyingParty</text></g><g class="participant participant-tail" data-participant="RP"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102.7168" x="703.2051" y="1112.5391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88.7168" x="710.2051" y="1132.5342">RelyingParty</text></g><rect fill="#FEFFDD" height="38" style="stroke:#181818;stroke-width:0.5;" width="302" x="603" y="51.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="290.0498" x="607" y="67.3638">Stored table (uhandle, AAGUID, credID, pkA)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109.9604" x="607" y="82.4966">from registration</text><rect fill="#FEFFDD" height="23" style="stroke:#181818;stroke-width:0.5;" width="402" x="449" y="99.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133.2373" x="583.5049" y="115.6294">TLS Setup (tbinding)</text><g class="message" data-participant-1="C" data-participant-2="RP"><polygon fill="#181818" points="742.5635,159.9609,752.5635,163.9609,742.5635,167.9609,746.5635,163.9609" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="545.9399" x2="748.5635" y1="163.9609" y2="163.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114.3149" x="591.0281" y="143.7622">auth_req,uhandle</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105.5234" x="597.49" y="158.895">(WebAuthn,TLS)</text></g><rect fill="#FEFFDD" height="38" style="stroke:#181818;stroke-width:0.5;" width="146" x="681" y="176.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.4043" x="685" y="193.0278">Searches for uhandle</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130.3047" x="685" y="208.1606">New Random nonce</text><g class="message" data-participant-1="RP" data-participant-2="C"><polygon fill="#181818" points="556.9399,252.4922,546.9399,256.4922,556.9399,260.4922,552.9399,256.4922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="550.9399" x2="753.5635" y1="256.4922" y2="256.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128.064" x="584.1536" y="236.2935">RpId, nonce, credID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105.5234" x="597.49" y="251.4263">(WebAuthn,TLS)</text></g><rect fill="#FEFFDD" height="23" style="stroke:#181818;stroke-width:0.5;" width="223" x="434" y="269.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215.0713" x="438" y="285.5591">Client searches for Authenticator</text><path d="M33,304.625 L173.3989,304.625 L173.3989,311.7578 L163.3989,321.7578 L33,321.7578 L33,304.625" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="194.1953" style="stroke:#000000;stroke-width:1.5;" width="610.2051" x="33" y="304.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="95.3989" x="48" y="317.6919">CTAP - Setup</text><g class="message" data-participant-1="C" data-participant-2="A"><polygon fill="#181818" points="168.8823,354.0234,158.8823,358.0234,168.8823,362.0234,164.8823,358.0234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="162.8823" x2="544.9399" y1="358.0234" y2="358.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132.0884" x="283.8008" y="337.8247">req_authtoken, RpId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.894" x="329.9641" y="352.9575">(CTAP)</text></g><g class="message" data-participant-1="A" data-participant-2="U"><polygon fill="#181818" points="353.7197,398.2891,363.7197,402.2891,353.7197,406.2891,357.7197,402.2891" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="157.8823" x2="359.7197" y1="402.2891" y2="402.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163.9219" x="177.7739" y="382.0903">Asks for User Verification</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.894" x="239.854" y="397.2231">(CTAP)</text></g><g class="message" data-participant-1="U" data-participant-2="A"><polygon fill="#181818" points="168.8823,442.5547,158.8823,446.5547,168.8823,450.5547,164.8823,446.5547" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="162.8823" x2="364.7197" y1="446.5547" y2="446.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15.9326" x="251.7686" y="426.356">uv</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.894" x="239.854" y="441.4888">(CTAP)</text></g><g class="message" data-participant-1="A" data-participant-2="C"><polygon fill="#181818" points="533.9399,486.8203,543.9399,490.8203,533.9399,494.8203,537.9399,490.8203" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="157.8823" x2="539.9399" y1="490.8203" y2="490.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108.6401" x="295.5249" y="470.6216">pinUVAuthToken</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.894" x="329.9641" y="485.7544">(CTAP)</text></g><rect fill="#FEFFDD" height="38" style="stroke:#181818;stroke-width:0.5;" width="300" x="395" y="510.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209.8979" x="399" y="526.8872">cData = &lt;RpId,nonce,tbinding&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="292.3096" x="399" y="542.02">pinAuth = HMAC(pinUVAuthToken, h(cData))</text><g class="message" data-participant-1="C" data-participant-2="A"><polygon fill="#181818" points="168.8823,586.3516,158.8823,590.3516,168.8823,594.3516,164.8823,590.3516" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="162.8823" x2="544.9399" y1="590.3516" y2="590.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212.1323" x="243.7788" y="570.1528">RpId, h(cData), pinAuthn, credID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.894" x="329.9641" y="585.2856">(CTAP)</text></g><rect fill="#FEFFDD" height="53" style="stroke:#181818;stroke-width:0.5;" width="306" x="5" y="603.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="298.4478" x="9" y="619.4185">Check HMAC(pinToken, h(cData)) == pinAuth</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="283.1689" x="9" y="634.5513">&lt;uhandle,RpId_A, skA&gt; = sdec(credID, wk)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137.4141" x="9" y="649.6841">Check RpId_A = RpId</text><g class="message" data-participant-1="A" data-participant-2="U"><polygon fill="#181818" points="353.7197,694.0156,363.7197,698.0156,353.7197,702.0156,357.7197,698.0156" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="157.8823" x2="359.7197" y1="698.0156" y2="698.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137.2236" x="191.123" y="677.8169">User Presence Check</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.894" x="239.854" y="692.9497">(CTAP)</text></g><g class="message" data-participant-1="U" data-participant-2="A"><polygon fill="#181818" points="168.8823,738.2813,158.8823,742.2813,168.8823,746.2813,164.8823,742.2813" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="162.8823" x2="364.7197" y1="742.2813" y2="742.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="16.4912" x="251.4893" y="722.0825">up</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.894" x="239.854" y="737.2153">(CTAP)</text></g><rect fill="#FEFFDD" height="53" style="stroke:#181818;stroke-width:0.5;" width="279" x="17" y="755.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="271.8955" x="21" y="771.3481">credID = senc(&lt;uhandle, RpId, skA&gt;, wk)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="270.3403" x="21" y="786.481">aData = &lt;h(RpId), up, cntr, credID, pkA&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236.0313" x="21" y="801.6138">sig =  sign(&lt;aData, h(cData)&gt;, skA)</text><g class="message" data-participant-1="A" data-participant-2="C"><polygon fill="#181818" points="533.9399,845.9453,543.9399,849.9453,533.9399,853.9453,537.9399,849.9453" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="157.8823" x2="539.9399" y1="849.9453" y2="849.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118.4536" x="290.6182" y="829.7466">aData,sig,uhandle</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.894" x="329.9641" y="844.8794">(CTAP)</text></g><g class="message" data-participant-1="C" data-participant-2="RP"><polygon fill="#181818" points="742.5635,890.2109,752.5635,894.2109,742.5635,898.2109,746.5635,894.2109" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="545.9399" x2="748.5635" y1="894.2109" y2="894.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164.9058" x="565.7327" y="874.0122">aData,sig,,uhandle,cData</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109.6558" x="595.4238" y="889.145">(WebAuthn, TLS)</text></g><rect fill="#FEFFDD" height="113" style="stroke:#181818;stroke-width:0.5;" width="277" x="615" y="907.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="264.894" x="619" y="923.2778">&lt;RpId_C, nonce_C, tbinding_C&gt; = cData</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="269.3882" x="619" y="938.4106">&lt;h(RpId_C),up,cntr,credID,pkA&gt; = aData</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209.917" x="619" y="953.5435">Validate tbinding_C,cntr, up flag</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135.6685" x="619" y="968.6763">Check RpId_c = RpId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.0825" x="619" y="983.8091">Check nonce_c = nonce</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225.4624" x="619" y="998.9419">Verify (sig,&lt;aData,h(cData)&gt;,pkA)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158.52" x="619" y="1014.0747">Grant access to uhandle</text><g class="message" data-participant-1="RP" data-participant-2="C"><polygon fill="#181818" points="556.9399,1058.4063,546.9399,1062.4063,556.9399,1066.4063,552.9399,1062.4063" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="550.9399" x2="753.5635" y1="1062.4063" y2="1062.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88.5244" x="603.9233" y="1042.2075">Access Token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33.5791" x="633.4622" y="1057.3403">(TLS)</text></g><polygon fill="#FEFFDD" points="57,1075.4063,854,1075.4063,864,1086.4063,854,1098.4063,57,1098.4063,47,1086.4063,57,1075.4063" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.3208" x="371.8005" y="1091.4731">Successful Authentication</text><!--SRC=[VLHDQzmm4BthLypH1WTwwc595eG2QQ0fPZURNWgBOi_QmexiI792_dr7ahqh9xGNVyp7ctblDBATqgCqyWNewLIbHgbTAUjQwGQ-VsE95VZaMjJqAzrWG5hWA_V1Oh0ULbRHAyhnTh6oxx3_e1ebcJwyTrSoPlJW48Otmg7VFLN16fnyxX6ogPMwxh40pkyEzxS5LEJqxx7ZER2J6Lx0OAEiCzAfGJFKTS1RmOg2W1z_xc6FRXeXSyzAUwhv9ToU5R7uEg6ky06jbGtoNZKQAcA3XechBVK86m2G9ClHu6injmX_TFORdxrQkg1Q-MTUA4tLeeKJgJZdi5_u3Zlw91Pwe9f9-xloQYisi1llwo8w5_B_hIJOBBrDwwrcc1Hfp41wY4TUmbKK9r3a6nBrzUWfkg53NOGsV5qVcZDECOSDSDj5-706dj2eawz0OxY47YBSzBRE9cQZqeSdtzYZBt5nKtVhuR7gLZe9Dt0Tn8XQB2FSCiBnAEJ_yS15jeOjeCr2UfxCcYZoHTd5NS2CerEPOqTfDvo95glkNEjp5RYvMP3OzN9wVQaZBy1sV4jzsXghR3d8xrq-GyOeylkFP4Ya5uaTD2uDMdys8MQaAdkHnt_rF3EYqfITdVkQDV1jnKRaedIRUHUfCesaXtPcjNbRPbL3OK0ldLs7h8i6su2Ow4q41ErC3AEKT6LYjpIHNPb6B255d7rwuY4S-K_R5Ox6KSoRuZ-M0t8KNl80msPQHv4Nn2lGcbcDSJAX0VOaUrLBGhzWn62lyAcNJJgmQXbOjCNwtXWNEcp51sIUr2pKHIT_YR4xuoz6MLLqtu0RpdV3bwk0nv3pkWGTsY23hCnWxGRsKuWvJNswyhIGVm40]--></g></svg>